

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyxccd.pyclassifier &mdash; pyxccd  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />

  
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            pyxccd
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial_en.html">Pyxccd Tutorial(English)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial_ch.html">Pyxccd指南(Chinese)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/pyxccd.html">Pyxccd API reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyxccd</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pyxccd.pyclassifier</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pyxccd.pyclassifier</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">os.path</span><span class="w"> </span><span class="kn">import</span> <span class="n">join</span><span class="p">,</span> <span class="n">exists</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">joblib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">Logger</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestClassifier</span>

<span class="c1"># from osgeo import gdal_array</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyxccd.app</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaults</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyxccd.utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_block_y</span><span class="p">,</span>
    <span class="n">get_block_x</span><span class="p">,</span>
    <span class="n">get_col_index</span><span class="p">,</span>
    <span class="n">get_row_index</span><span class="p">,</span>
    <span class="n">assemble_array</span><span class="p">,</span>
    <span class="n">rio_loaddata</span><span class="p">,</span>
    <span class="n">extract_features</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyxccd.common</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatasetInfo</span>


<div class="viewcode-block" id="generate_sample_num">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.generate_sample_num">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_sample_num</span><span class="p">(</span><span class="n">label</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sample_parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;generate sample number for each land cover category using the method from the paper &#39;Optimizing</span>
<span class="sd">    selection of training and auxiliary data for operational land cover classification for the LCMAP initiative&#39;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    label : np.ndarray</span>
<span class="sd">        a label map</span>
<span class="sd">    sample_parameters : dict</span>
<span class="sd">        a dictionary must include &quot;total_landcover_category&quot;, &quot;total_samples&quot;, &quot;max_category_samples&quot;, and &quot;min_category_samples&quot;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">        1-d array that stores the sample number for each label</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unique_category</span><span class="p">,</span> <span class="n">unique_counts_category</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
        <span class="n">label</span><span class="p">[</span><span class="n">label</span> <span class="o">&lt;=</span> <span class="n">sample_parameters</span><span class="p">[</span><span class="s2">&quot;total_landcover_category&quot;</span><span class="p">]],</span>
        <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">counts_category</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">sample_parameters</span><span class="p">[</span><span class="s2">&quot;total_landcover_category&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_counts_category</span><span class="p">)):</span>
        <span class="n">counts_category</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">unique_category</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">unique_counts_category</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">percate_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">counts_category</span><span class="p">)</span> <span class="o">*</span> <span class="n">sample_parameters</span><span class="p">[</span><span class="s2">&quot;total_samples&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">counts_category</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">percate_samples</span><span class="p">[</span><span class="n">percate_samples</span> <span class="o">&gt;</span> <span class="n">sample_parameters</span><span class="p">[</span><span class="s2">&quot;max_category_samples&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sample_parameters</span><span class="p">[</span><span class="s2">&quot;max_category_samples&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">percate_samples</span><span class="p">[</span><span class="n">percate_samples</span> <span class="o">&lt;</span> <span class="n">sample_parameters</span><span class="p">[</span><span class="s2">&quot;min_category_samples&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sample_parameters</span><span class="p">[</span><span class="s2">&quot;min_category_samples&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># needs to check not exceed the total category pixels</span>
    <span class="n">percate_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">percate_samples</span><span class="p">,</span> <span class="n">counts_category</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">percate_samples</span></div>



<div class="viewcode-block" id="get_features">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.get_features">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_features</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get block-based features</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str</span>
<span class="sd">        Path for feature output</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">        2-d array for block-based features, (block_width*block_height, total feature)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>



<div class="viewcode-block" id="PyClassifier">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifier">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PyClassifier</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataset_info</span><span class="p">:</span> <span class="n">DatasetInfo</span><span class="p">,</span>
        <span class="n">feature_outputs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;a0&quot;</span><span class="p">,</span> <span class="s2">&quot;a1&quot;</span><span class="p">,</span> <span class="s2">&quot;b1&quot;</span><span class="p">],</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">band_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset_info : :py:type:`~pyxccd.common.DatasetInfo`</span>
<span class="sd">            time-series basic dataset info</span>
<span class="sd">        feature_outputs : list, optional</span>
<span class="sd">            Indicate which features to be outputted.  They must be within [a0, c1, a1, b1,a2, b2, a3,</span>
<span class="sd">            b3, rmse], by default [&quot;a0&quot;, &quot;a1&quot;, &quot;b1&quot;]</span>
<span class="sd">        logger : Optional[Logger], optional</span>
<span class="sd">            log handler, by default None</span>
<span class="sd">        band_num : int, optional</span>
<span class="sd">            the band number to be processed, by default 7</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span> <span class="o">=</span> <span class="n">dataset_info</span>
        <span class="c1"># self.dataset_info.block_width = int(self.dataset_info.n_cols / self.dataset_info.n_block_x)</span>
        <span class="c1"># self.dataset_info.block_height = int(self.dataset_info.n_rows / self.dataset_info.n_block_y)</span>
        <span class="c1"># self.dataset_info.nblocks = self.dataset_info.n_block_x * self.dataset_info.n_block_y</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">feature_outputs</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">feature</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a0&quot;</span><span class="p">,</span> <span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="s2">&quot;a1&quot;</span><span class="p">,</span> <span class="s2">&quot;b1&quot;</span><span class="p">,</span> <span class="s2">&quot;a2&quot;</span><span class="p">,</span> <span class="s2">&quot;b2&quot;</span><span class="p">,</span> <span class="s2">&quot;a3&quot;</span><span class="p">,</span> <span class="s2">&quot;b3&quot;</span><span class="p">,</span> <span class="s2">&quot;rmse&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span> <span class="o">=</span> <span class="n">band_num</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_outputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_outputs</span> <span class="o">=</span> <span class="n">feature_outputs</span>
        <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
                <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
                <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> |</span><span class="si">%(levelname)s</span><span class="s2">| </span><span class="si">%(funcName)-15s</span><span class="s2">| </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">band_num</span> <span class="o">=</span> <span class="n">band_num</span>

<div class="viewcode-block" id="PyClassifier.predict_features">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifier.predict_features">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">predict_features</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">block_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">cold_block</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">year_list_to_predict</span><span class="p">:</span> <span class="nb">list</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        block_id: int</span>
<span class="sd">            Block id, started from 1</span>
<span class="sd">        cold_block: np.ndarray</span>
<span class="sd">            Block-based :py:type:`~pyxccd.common.cold_rec_cg` produced by COLD algorithms</span>
<span class="sd">        year_list_to_predict: list</span>
<span class="sd">            A list of the years to extract features</span>
<span class="sd">            Note that the reason for not parsing cold_block to get year bounds is that the year range of blocks</span>
<span class="sd">            may vary from each other, so the year bounds are required to be defined from the tile level, not block level</span>
<span class="sd">            such as from &#39;starting_end_date.txt&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            3d array, (len(year_list_to_predict), block_width*block_height, n_features)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">block_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">year_list_to_predict</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_height</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;COMMON&quot;</span><span class="p">][</span><span class="s2">&quot;NAN_VAL&quot;</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ordinal_day_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toordinal</span><span class="p">()</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">year_list_to_predict</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cold_block</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;the rec_cg file for block_id=</span><span class="si">{}</span><span class="s2"> has no records&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">block_features</span>

        <span class="n">cold_block_split</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
            <span class="n">cold_block</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cold_block</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">cold_block_split</span><span class="p">:</span>
            <span class="c1"># the relative column number in the block</span>
            <span class="n">i_col</span> <span class="o">=</span> <span class="n">get_col_index</span><span class="p">(</span>
                <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;pos&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_cols</span><span class="p">,</span>
                <span class="n">get_block_x</span><span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_x</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_width</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">i_row</span> <span class="o">=</span> <span class="n">get_row_index</span><span class="p">(</span>
                <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;pos&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_cols</span><span class="p">,</span>
                <span class="n">get_block_y</span><span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_x</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_height</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_num</span><span class="p">):</span>
                <span class="n">feature_row</span> <span class="o">=</span> <span class="n">extract_features</span><span class="p">(</span>
                    <span class="n">element</span><span class="p">,</span>
                    <span class="n">band</span><span class="p">,</span>
                    <span class="n">ordinal_day_list</span><span class="p">,</span>
                    <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;COMMON&quot;</span><span class="p">][</span><span class="s2">&quot;NAN_VAL&quot;</span><span class="p">],</span>
                    <span class="n">feature_outputs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_outputs</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_num</span><span class="p">)):</span>
                    <span class="n">block_features</span><span class="p">[</span>
                        <span class="p">:,</span>
                        <span class="n">i_row</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_width</span> <span class="o">+</span> <span class="n">i_col</span><span class="p">,</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">band</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_num</span><span class="p">)</span> <span class="o">+</span> <span class="n">index</span><span class="p">,</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="n">feature_row</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">block_features</span></div>


<div class="viewcode-block" id="PyClassifier.train_rfmodel">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifier.train_rfmodel">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">train_rfmodel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_feature_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;training a random forest model based on feature layers and a label map</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        full_feature_array : np.ndarray</span>
<span class="sd">            3-d array for full feature layers, (nrows, ncols, feature_number)</span>
<span class="sd">        label : np.ndarray</span>
<span class="sd">            1-d array for a label map</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        class</span>
<span class="sd">            A sklearn random forest model</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="n">label</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_cols</span><span class="p">)</span>
        <span class="n">samplecount</span> <span class="o">=</span> <span class="n">generate_sample_num</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;CLASSIFIER&quot;</span><span class="p">])</span>
        <span class="n">index_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">label_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;CLASSIFIER&quot;</span><span class="p">][</span><span class="s2">&quot;total_landcover_category&quot;</span><span class="p">]):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">label</span> <span class="o">==</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># set random seed to reproduce the same result</span>
            <span class="n">index_sample</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">samplecount</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index_sample</span><span class="p">)</span>
            <span class="n">label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_sample</span><span class="p">)))</span>
        <span class="n">index_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">index_list</span><span class="p">)</span>
        <span class="n">label_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">label_list</span><span class="p">)</span>
        <span class="n">feature_extraction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">full_feature_array</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">index_list</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">rf_model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">rf_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">feature_extraction</span><span class="p">,</span> <span class="n">label_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rf_model</span></div>


<div class="viewcode-block" id="PyClassifier.classify_block">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifier.classify_block">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">classify_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rf_model</span><span class="p">,</span> <span class="n">tmp_feature</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;classify feature block for a single year</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rf_model : dict</span>
<span class="sd">            sklearn random forest model</span>
<span class="sd">        tmp_feature : np.ndarray</span>
<span class="sd">            2-d array for features, (block_width*block_height, n_features)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">            2d array, a classification map, (block_height, block_width)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">tmp_feature</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_width</span>
        <span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tmp_feature</span> <span class="o">==</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;COMMON&quot;</span><span class="p">][</span><span class="s2">&quot;NAN_VAL&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_width</span>
        <span class="p">)</span>
        <span class="n">cmap</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
        <span class="k">return</span> <span class="n">cmap</span></div>
</div>


    <span class="c1"># def _assemble_covermap(self, blocklist_yearlyclass, year):</span>
    <span class="c1">#     full_yearlyclass_array = assemble_array(blocklist_yearlyclass, self.dataset_info.n_block_x)</span>
    <span class="c1">#     if (full_yearlyclass_array.shape[1] != self.dataset_info.n_cols) or (full_yearlyclass_array.shape[0] !=</span>
    <span class="c1">#                                                                       self.dataset_info.n_rows):</span>
    <span class="c1">#         logger.error(&#39;The assemble category map is incomplete for {}&#39;.format(year))</span>
    <span class="c1">#         return full_yearlyclass_array[:, :, 0]  # we only return the first channel</span>


<div class="viewcode-block" id="PyClassifierHPC">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifierHPC">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PyClassifierHPC</span><span class="p">(</span><span class="n">PyClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    this class adds IO functions based on the HPC environment for the base class</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataset_info</span><span class="p">:</span> <span class="n">DatasetInfo</span><span class="p">,</span>
        <span class="n">record_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">band_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
        <span class="n">year_list_to_predict</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1982</span><span class="p">,</span> <span class="mi">2022</span><span class="p">)),</span>
        <span class="n">tmp_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">feature_outputs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;a0&quot;</span><span class="p">,</span> <span class="s2">&quot;a1&quot;</span><span class="p">,</span> <span class="s2">&quot;b1&quot;</span><span class="p">],</span>
        <span class="n">seedmap_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rf_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset_info : DatasetInfo</span>
<span class="sd">            Time-series dataset information data class</span>
<span class="sd">        record_path : str</span>
<span class="sd">            Path that are source folder for the COLD results</span>
<span class="sd">        band_num : int, optional</span>
<span class="sd">            The band number, by default 7</span>
<span class="sd">        year_list_to_predict : _type_, optional</span>
<span class="sd">            A list of years for classification, by default list(range(1982, 2022))</span>
<span class="sd">        tmp_path : Optional[str], optional</span>
<span class="sd">            Path for saving temporal files, by default None. if None, will set /record_path/feature_maps</span>
<span class="sd">        output_path : Optional[str], optional</span>
<span class="sd">            Path to save classification outputS, by default None</span>
<span class="sd">        feature_outputs : list, optional</span>
<span class="sd">            A list of outputted feature name, it must be within [a0, c1, a1, b1,a2, b2, a3, b3,</span>
<span class="sd">            rmse]. by default [&quot;a0&quot;, &quot;a1&quot;, &quot;b1&quot;]</span>
<span class="sd">        seedmap_path : Optional[str], optional</span>
<span class="sd">            Path for the seed map that provides labels to produce rf model, by default None</span>
<span class="sd">        rf_path : Optional[str], optional</span>
<span class="sd">            Path for existing random forest forest, by default None</span>
<span class="sd">        logger : Optional[Logger], optional</span>
<span class="sd">            Logger handler, by default None</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        e</span>
<span class="sd">            Raise the error when the parameter inputs for initializing classifier are not correct</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_inputs_thematic</span><span class="p">(</span>
                <span class="n">dataset_info</span><span class="p">,</span> <span class="n">record_path</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">seedmap_path</span><span class="p">,</span> <span class="n">rf_path</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">FileExistsError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">e</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span> <span class="o">=</span> <span class="n">dataset_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">record_path</span> <span class="o">=</span> <span class="n">record_path</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">feature_outputs</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">feature</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a0&quot;</span><span class="p">,</span> <span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="s2">&quot;a1&quot;</span><span class="p">,</span> <span class="s2">&quot;b1&quot;</span><span class="p">,</span> <span class="s2">&quot;a2&quot;</span><span class="p">,</span> <span class="s2">&quot;b2&quot;</span><span class="p">,</span> <span class="s2">&quot;a3&quot;</span><span class="p">,</span> <span class="s2">&quot;b3&quot;</span><span class="p">,</span> <span class="s2">&quot;rmse&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_outputs</span> <span class="o">=</span> <span class="n">feature_outputs</span>

        <span class="k">if</span> <span class="n">tmp_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">record_path</span><span class="p">,</span> <span class="s2">&quot;feature_maps&quot;</span><span class="p">)</span>  <span class="c1"># default path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span> <span class="o">=</span> <span class="n">tmp_path</span>

        <span class="k">if</span> <span class="n">output_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">record_path</span><span class="p">,</span> <span class="s2">&quot;feature_maps&quot;</span><span class="p">)</span>  <span class="c1"># default path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span> <span class="o">=</span> <span class="n">band_num</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_outputs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">year_list_to_predict</span> <span class="o">=</span> <span class="n">year_list_to_predict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seedmap_path</span> <span class="o">=</span> <span class="n">seedmap_path</span>
        <span class="k">if</span> <span class="n">rf_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rf_path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;rf.model&quot;</span><span class="p">)</span>  <span class="c1"># default path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rf_path</span> <span class="o">=</span> <span class="n">rf_path</span>

        <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
                <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
                <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> |</span><span class="si">%(levelname)s</span><span class="s2">| </span><span class="si">%(funcName)-15s</span><span class="s2">| </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">band_num</span> <span class="o">=</span> <span class="n">band_num</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_inputs_thematic</span><span class="p">(</span>
        <span class="n">dataset_info</span><span class="p">,</span> <span class="n">record_path</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span> <span class="n">seedmap_path</span><span class="p">,</span> <span class="n">rf_path</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;check the inputs for initializing a classifier</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset_info : DatasetInfo</span>
<span class="sd">            Basic information of time-series dataset</span>
<span class="sd">        record_path : str</span>
<span class="sd">            Path that saved COLD results</span>
<span class="sd">        tmp_path : str</span>
<span class="sd">            Path for saving temporal files, by default None. if None, will set /record_path/feature_maps</span>
<span class="sd">        seedmap_path : str</span>
<span class="sd">            Path for the seed map that provides labels to produce rf model, by default None</span>
<span class="sd">        rf_path : str</span>
<span class="sd">            Path for existing random forest forest, by default None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_rows</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_rows</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;n_rows must be positive integer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_cols</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_cols</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;n_cols must be positive integer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_x</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;n_block_x must be positive integer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_y</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_y</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;n_block_y must be positive integer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_y</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_y</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;n_block_y must be positive integer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">record_path</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s2">&quot;No such directory: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">record_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">seedmap_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">seedmap_path</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s2">&quot;No such file: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">seedmap_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">rf_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">rf_path</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span><span class="s2">&quot;No such file: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rf_path</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">block_features</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        block_id: integer</span>
<span class="sd">        block_features</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">year_list_to_predict</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;tmp_feature_year</span><span class="si">{}</span><span class="s2">_block</span><span class="si">{}</span><span class="s2">.npy&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">year</span><span class="p">,</span> <span class="n">block_id</span>
                <span class="p">),</span>
                <span class="n">block_features</span><span class="p">[</span><span class="nb">id</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span>
            <span class="p">)</span>

<div class="viewcode-block" id="PyClassifierHPC.is_finished_step1_predict_features">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifierHPC.is_finished_step1_predict_features">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_finished_step1_predict_features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">iblock</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">nblocks</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span>
                <span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">,</span>
                    <span class="s2">&quot;tmp_step1_predict_</span><span class="si">{}</span><span class="s2">_finished.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">iblock</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_save_rf_model</span><span class="p">(</span><span class="n">rf_model</span><span class="p">,</span> <span class="n">rf_path</span><span class="p">):</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rf_model</span><span class="p">,</span> <span class="n">rf_path</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_finished_step2_train_rfmodel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rf_path</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_rf_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rf_path</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_yearlyclassification_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">cmap</span><span class="p">):</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">,</span>
            <span class="s2">&quot;tmp_yearlyclassification</span><span class="si">{}</span><span class="s2">_block</span><span class="si">{}</span><span class="s2">.npy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">block_id</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_finished_step3_classification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: True or false</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">iblock</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">nblocks</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span>
                <span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">,</span>
                    <span class="s2">&quot;tmp_step3_classification_</span><span class="si">{}</span><span class="s2">_finished.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">iblock</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_covermaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_yearlyclass_array</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;yearlyclassification_</span><span class="si">{}</span><span class="s2">.npy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">)),</span>
            <span class="n">full_yearlyclass_array</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tmp_yearlyclass_filenames</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;tmp_&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tmp_yearlyclass_filenames</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_fullclassification_forcertainyear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
        <span class="n">tmp_yearlyclass_filenames</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">file</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;tmp_yearlyclassification</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>
        <span class="p">]</span>

        <span class="c1"># sort to guarantee order follows low to high rows</span>
        <span class="n">tmp_yearlyclass_filenames</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;block&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span> <span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.npy&quot;</span><span class="p">)])</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_width</span><span class="p">,</span> <span class="mi">1</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tmp_yearlyclass_filenames</span>
        <span class="p">]</span>

<div class="viewcode-block" id="PyClassifierHPC.get_fullfeature_forcertainyear">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifierHPC.get_fullfeature_forcertainyear">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_fullfeature_forcertainyear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year : int</span>
<span class="sd">            Year to get a feature</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A list of all blocks as 3-d array (block_height, block_width, n_features)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmp_feature_filenames</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">file</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;tmp_feature_year</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_feature_filenames</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">nblocks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;tmp features are incomplete! should have </span><span class="si">{}</span><span class="s2">; but actually have </span><span class="si">{}</span><span class="s2"> feature images&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">nblocks</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_feature_filenames</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">tmp_feature_filenames</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;block&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span> <span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.npy&quot;</span><span class="p">)])</span>
        <span class="p">)</span>  <span class="c1"># sorted by row number</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_height</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_width</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tmp_feature_filenames</span>
        <span class="p">]</span></div>


        <span class="c1"># full_feature_array = assemble_array(, self.dataset_info.n_block_x)</span>
        <span class="c1"># if (full_feature_array.shape[1] != self.dataset_info.n_cols) or (full_feature_array.shape[0] !=</span>
        <span class="c1">#                                                               self.dataset_info.n_rows):</span>
        <span class="c1">#     logger.error(&#39;The feature image is incomplete for {}&#39;.format(year))</span>
        <span class="c1"># return full_feature_array</span>

<div class="viewcode-block" id="PyClassifierHPC.hpc_preparation">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifierHPC.hpc_preparation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">hpc_preparation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>

        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span></div>


<div class="viewcode-block" id="PyClassifierHPC.step1_feature_generation">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifierHPC.step1_feature_generation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">step1_feature_generation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;generate feature based on COLD results</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        block_id : int</span>
<span class="sd">            the id of block</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
            <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">record_path</span><span class="p">,</span> <span class="s2">&quot;record_change_x</span><span class="si">{}</span><span class="s2">_y</span><span class="si">{}</span><span class="s2">_cold.npy&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">get_block_x</span><span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_x</span><span class="p">),</span>
                <span class="n">get_block_y</span><span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_x</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="n">cold_block</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">record_path</span><span class="p">,</span> <span class="s2">&quot;record_change_x</span><span class="si">{}</span><span class="s2">_y</span><span class="si">{}</span><span class="s2">_cold.npy&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">get_block_x</span><span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_x</span><span class="p">),</span>
                    <span class="n">get_block_y</span><span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_x</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">block_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_features</span><span class="p">(</span>
                <span class="n">block_id</span><span class="p">,</span> <span class="n">cold_block</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">year_list_to_predict</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">block_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">year_list_to_predict</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_width</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">block_height</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;COMMON&quot;</span><span class="p">][</span><span class="s2">&quot;NAN_VAL&quot;</span><span class="p">],</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_features</span><span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">block_features</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;tmp_step1_predict_</span><span class="si">{}</span><span class="s2">_finished.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_id</span><span class="p">)),</span>
            <span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="PyClassifierHPC.step2_train_rf">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifierHPC.step2_train_rf">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">step2_train_rf</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ref_year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rf_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;training a random forest model, and save it into rf_path</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ref_year : int, optional</span>
<span class="sd">            The year to provide features which will be further connected to seed map, by default None</span>
<span class="sd">        rf_path : str, optional</span>
<span class="sd">            Path to save random forest model , by default None. If none, will saved to rf_path</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            couldn&#39;t locate seedmap that provide label maps</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_finished_step1_predict_features</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ref_year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ref_year</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;CLASSIFIER&quot;</span><span class="p">][</span><span class="s2">&quot;training_year&quot;</span><span class="p">]</span>

        <span class="c1"># if ref_year not in self.year_list_to_predict:</span>
        <span class="c1">#     raise Exception(&quot;Ref_year {} is not in year_list_to_predict {}. &quot;</span>
        <span class="c1">#                     &quot;PLease included it and re-run step1_feature_generation&quot;.format(ref_year,</span>
        <span class="c1">#                                                                                     self.year_list_to_predict))</span>

        <span class="n">full_feature_array</span> <span class="o">=</span> <span class="n">assemble_array</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_fullfeature_forcertainyear</span><span class="p">(</span><span class="n">ref_year</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_x</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seedmap_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;seedmap_path is not assigned&quot;</span><span class="p">)</span>

        <span class="n">label_array</span> <span class="o">=</span> <span class="n">rio_loaddata</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seedmap_path</span><span class="p">))</span>
        <span class="n">rf_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_rfmodel</span><span class="p">(</span><span class="n">full_feature_array</span><span class="p">,</span> <span class="n">label_array</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rf_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_rf_model</span><span class="p">(</span><span class="n">rf_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rf_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_rf_model</span><span class="p">(</span><span class="n">rf_model</span><span class="p">,</span> <span class="n">rf_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="PyClassifierHPC.step3_classification">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifierHPC.step3_classification">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">step3_classification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;classify a block</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        block_id : int_</span>
<span class="sd">            the block id</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        IOError</span>
<span class="sd">            _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_finished_step2_train_rfmodel</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span>
            <span class="mi">5</span>
        <span class="p">)</span>  <span class="c1"># wait for 5 more seconds to guarantee all data of rf.model was down to the disk</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rf_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_rf_model</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                <span class="s2">&quot;Please double check your rf model file directory or generate random forest model first&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">year_list_to_predict</span><span class="p">:</span>
            <span class="n">tmp_feature_block</span> <span class="o">=</span> <span class="n">get_features</span><span class="p">(</span>
                <span class="n">join</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">,</span>
                    <span class="s2">&quot;tmp_feature_year</span><span class="si">{}</span><span class="s2">_block</span><span class="si">{}</span><span class="s2">.npy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">block_id</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classify_block</span><span class="p">(</span><span class="n">rf_model</span><span class="p">,</span> <span class="n">tmp_feature_block</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_yearlyclassification_maps</span><span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">,</span>
                <span class="s2">&quot;tmp_step3_classification_</span><span class="si">{}</span><span class="s2">_finished.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_id</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="PyClassifierHPC.step3_classification_sccd">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifierHPC.step3_classification_sccd">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">step3_classification_sccd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;classifying based on sccd output</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        block_id : int</span>
<span class="sd">            block id</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        IOError</span>
<span class="sd">            couldn&#39;t locate rf model file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_finished_step2_train_rfmodel</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rf_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_rf_model</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span>
                <span class="s2">&quot;Please double check your rf model file directory or generate random forest model first&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="c1"># for year in self.year_list_to_predict:</span>
        <span class="c1">#     tmp_feature_block = get_features(join(self.tmp_path, &#39;tmp_feature_year{}_block{}.npy&#39;.format(year,</span>
        <span class="c1">#                                                                                                 block_id)))</span>
        <span class="c1">#     cmap = self.classify_block(rf_model, tmp_feature_block)</span>
        <span class="c1">#     self._save_yearlyclassification_maps(block_id, year, cmap)</span>

        <span class="n">tmp_feature_block</span> <span class="o">=</span> <span class="n">get_features</span><span class="p">(</span>
            <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;tmp_feature_now_block</span><span class="si">{}</span><span class="s2">.npy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_id</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span>
            <span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">,</span>
                <span class="s2">&quot;tmp_step3_classification_</span><span class="si">{}</span><span class="s2">_finished.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_id</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classify_block</span><span class="p">(</span><span class="n">rf_model</span><span class="p">,</span> <span class="n">tmp_feature_block</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_yearlyclassification_maps</span><span class="p">(</span><span class="n">block_id</span><span class="p">,</span> <span class="s2">&quot;now&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tmp_path</span><span class="p">,</span>
                <span class="s2">&quot;tmp_step3_classification_</span><span class="si">{}</span><span class="s2">_finished.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">block_id</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="PyClassifierHPC.step4_assemble">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifierHPC.step4_assemble">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">step4_assemble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;assesmble all block-based classification results into one map</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        clean : bool, optional</span>
<span class="sd">            _description_, by default True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_finished_step3_classification</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">year_list_to_predict</span><span class="p">:</span>
            <span class="n">full_yearlyclass_array</span> <span class="o">=</span> <span class="n">assemble_array</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_fullclassification_forcertainyear</span><span class="p">(</span><span class="n">year</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_x</span><span class="p">,</span>
            <span class="p">)[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_covermaps</span><span class="p">(</span><span class="n">full_yearlyclass_array</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clean</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clean</span><span class="p">()</span>  <span class="c1"># _clean all temp files</span></div>


<div class="viewcode-block" id="PyClassifierHPC.step4_assemble_sccd">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifierHPC.step4_assemble_sccd">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">step4_assemble_sccd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;assessmble all block-based classification results based upon sccd into one map</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        clean : bool, optional</span>
<span class="sd">            _description_, by default True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_finished_step3_classification</span><span class="p">():</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">full_yearlyclass_array</span> <span class="o">=</span> <span class="n">assemble_array</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_fullclassification_forcertainyear</span><span class="p">(</span><span class="s2">&quot;now&quot;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset_info</span><span class="o">.</span><span class="n">n_block_x</span><span class="p">,</span>
        <span class="p">)[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_covermaps</span><span class="p">(</span><span class="n">full_yearlyclass_array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="s2">&quot;now&quot;</span><span class="p">)</span>

        <span class="c1"># for year in self.year_list_to_predict:</span>
        <span class="c1">#     full_yearlyclass_array = assemble_array(self._get_fullclassification_forcertainyear(year),</span>
        <span class="c1">#                                             self.dataset_info.n_block_x)[:, :, 0]</span>
        <span class="c1">#     self._save_covermaps(full_yearlyclass_array, year)</span>
        <span class="k">if</span> <span class="n">clean</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clean</span><span class="p">()</span>  <span class="c1"># _clean all temp files</span></div>


<div class="viewcode-block" id="PyClassifierHPC.is_finished_step4_assemble">
<a class="viewcode-back" href="../../api/pyxccd.pyclassifier.html#pyxccd.pyclassifier.PyClassifierHPC.is_finished_step4_assemble">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_finished_step4_assemble</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;check if step is finished</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">year_list_to_predict</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;yearlyclassification_</span><span class="si">{}</span><span class="s2">.npy&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Su Ye.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>